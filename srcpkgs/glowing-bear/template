# Template file for 'glowing-bear'
pkgname=glowing-bear
version=0.7.2
revision=1
archs="x86_64"
hostmakedepends="nodejs-lts git"
short_desc="WeeChat electron web frontend"
maintainer="TROUVERIE Joachim <jtrouverie@joakode.fr>"
license="GPL-3.0-only"
homepage="https://www.glowing-bear.org/#!/"
distfiles="https://github.com/glowing-bear/glowing-bear/archive/${version}.tar.gz"
checksum=ecb708efa01d65bfec0229502b8ecec373b421a2327b9f1633627df58179164e
nostrip_files="Glowing-Bear"


pre_configure() {
	vsed -i 's/bower install/bower install --allow-root/' electron.makefile
}

do_build() {
	npm install
	npm install electron-packager
}

do_install() {
	BIN_NAME=$(echo "Glowing Bear" | tr ' ' '-')
	npm run build-electron-linux

	vmkdir usr/lib/${pkgname}
	mv "Glowing Bear-linux-x64" build
	mv "build/Glowing Bear" build/${BIN_NAME}
	vcopy build/* usr/lib/${pkgname}

	vmkdir usr/bin
	ln -s /usr/lib/${pkgname}/${BIN_NAME} ${DESTDIR}/usr/bin/${BIN_NAME}
}
